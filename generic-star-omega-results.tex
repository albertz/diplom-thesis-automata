\section{General results}
\label{general-results}

%S401: TODO

Let $\Lang$ be a $*$-language class.

\subsection{general}
\label{gen:general}
Let $L,A,B \in \Lang$.
\begin{enumerate}
\item $\ext L = L \cdot \Sigma^\omega$
\item $\ext L = \lim L \cdot \Sigma^*$ %S303
\item $\ext L = \dlim L \cdot \Sigma^*$ %S303, S305.4
\item $- \lim(-L) = \dlim L$
\item $\dlim L \subseteq \lim L$
\item $\lim A \cup \lim B = \lim A \cup B$ \newline %S305.4
Proof:
\begin{align*}
& \alpha \in \lim A \cup \lim B \\
\Leftrightarrow \ & \existsinf n \colon \alpha[0,n] \in A \ \vee \ \existsinf n \colon \alpha[0,n] \in B \\
\Leftrightarrow \ & \existsinf n \colon \alpha[0,n] \in A \cup B \\
\Leftrightarrow \ & \alpha \in \lim A \cup B
\end{align*}
\item $\dlim A \cup \dlim B \subseteq \dlim A \cup B$ \newline %S305.4
Proof:
\begin{align*}
& \alpha \in \dlim A \cup \dlim B \\
\Leftrightarrow \ & \exists N \colon \forall n \ge N \colon \alpha[0,n] \in A \ \vee \ 
\exists N \colon \forall n \ge N \colon \alpha[0,n] \in B \\
\Rightarrow \ & \exists N \colon \forall n \ge N \colon \alpha[0,n] \in A \cup B
\end{align*}
There is no equality in general: $A = (00)^*$, $B = (00)^*0$.
\end{enumerate}

\

%S302.1:
We are interested in relations like $\BC \ext \Lang \overset{?}{\subsetneqq} \BC \lim \Lang$ or $\ext \Lang \overset{?}{\subsetneqq} \lim \Lang$. With $\Lang = \Set{\Set{a}}$, we realize that even $\ext \Lang \subseteq \lim \Lang$ is not true in general ($\ext \Set{\Set{a}} = \Set{a \Sigma^\omega} \neq \emptyset = \lim \Set{\Set{a}}$). In \ref{gen:non-suffix-sens}, we see a sufficient condition for this property, though.

\subsection{non suffix sensitive}
\label{gen:non-suffix-sens}

% S303, S101a:
If E1 ($\forall L \in \Lang \colon L \cdot \Sigma^* \in \Lang$, i.e. $\Lang$ is non suffix sensitive) holds for $\Lang$: For $L \in \Lang$, we have $\ext L = \lim L \Sigma^* = \dlim L \Sigma^*$ and thus
\[ \ext \Lang \subseteq \lim \Lang \cup \dlim \Lang . \]

\subsection{$\BC \ext \subseteq \BC \lim$}
\label{gen:S302a}

%S302:
From $\ext \Lang \subseteq \lim \Lang$, it directly follows $\Set{-\ext L}{L \in \Lang} \subseteq \Set{-\lim L}{L \in \Lang}$. Thus, it also follows
\[ \BC \ext \Lang \subseteq \BC \lim \Lang . \]

\subsection{$\dext \subset \dlim$}

%S302:
From $\ext \Lang \subseteq \lim \Lang$, we need E3 ($\Lang$ closed under negation) to get $\dext \Lang \subseteq \dlim \Lang$. This is in contrast to \ref{gen:S302a}, where it directly follows. We have to be careful about the difference $- \ext \Lang \neq \dext \Lang$ (in general, if E3 does not hold). 

\subsection{union, intersection}
%S303:
\begin{itemize}
\item
E2a (closed under union) $\Rightarrow \bigcup \ext \Lang \subseteq \ext \Lang$.
\item
E2b (closed under intersection) $\Rightarrow \bigcap \ext \Lang \subseteq \ext \Lang$.
\end{itemize}

\subsection{$op \cup \overline{op} \subsetneqq \BC op$}
If there is $L_\Sigma \in \Lang_\Sigma$ with $L_\Sigma \in \ext \Lang_\Sigma, L_\Sigma \not\in \dext \Lang_\Sigma$ and E3 (closed under negation) holds for $\Lang$:
\begin{itemize}
\item[$\Rightarrow$] $-L_\Sigma \in \dext \Lang_\Sigma, -L_\Sigma \not\in \ext \Lang_\Sigma$
\item[$\Rightarrow$] $L_{\Sigma_1} \cup -L_{\Sigma_2} \in \BC \ext \Lang_{\Sigma_1 \dot{\cup} \Sigma_2}$ \newline
$L_{\Sigma_1} \cup -L_{\Sigma_2} \not\in \ext \cup \dext \Lang_{\Sigma_1 \dot{\cup} \Sigma_2}$
\end{itemize}
Thus,
\[ \ext \cup \dext \Lang \subsetneqq \BC \ext \Lang . \]

Similarily, if there is $L_\Sigma \in \lim \Lang_\Sigma, L_\Sigma \not\in \dlim \Lang_\Sigma$ and E3 holds for $\Lang$:
\begin{itemize}
\item[$\Rightarrow$] $-L_\Sigma \in \dlim \Lang_\Sigma, -L_\Sigma \not\in \lim \Lang_\Sigma$
\item[$\Rightarrow$] $L_{\Sigma_1} \cup -L_{\Sigma_2} \in \BC \lim \Lang_{\Sigma_1 \dot{\cup} \Sigma_2}$ \newline
$L_{\Sigma_1} \cup -L_{\Sigma_2} \not\in \lim \cup \dlim \Lang_{\Sigma_1 \dot{\cup} \Sigma_2}$
\end{itemize}
Thus,
\[ \lim \cup \dlim \Lang \subsetneqq \BC \lim \Lang . \]


\subsection{$\BC \ext = \lim \cap \dlim$}
\label{gen:staiger-wagner}
%S405:
A Staiger-Wagner automaton (weak Muller automaton) is of the same form $\A = (Q,\Sigma,q_0,\delta,\F)$ as a Muller automaton with the acceptance condition that a run $\rho$ is accepting if and only if $\Occ(\rho) := \Set{q \in Q \colon \text{q occurs in } p} \in \F$.  (R101,Def.61,p.43)

We see (R101,Th.63+64,p.44) that the class of Staigner-Wagner-recognized languages is exactly the class $\BC \ext \Lang^*(reg)$ and also $\lim \cap \dlim \Lang^*(reg)$.

We are now formulating a more general and direct proof for the $\BC \ext \Lang = \lim \cap \dlim \Lang$ equality without Staiger-Wagner-automata (where some of the ideas are loosely based on (R101,Th.63+64,p.44)).

\

%S305:
First, we show $\lim \cap \dlim \Lang \subseteq \BC \ext \Lang$.

Let $\tilde L \in \lim \cap \dlim \Lang$, i.e. there are deterministic automaton $\A$ and $\overline \A$ so that $L^\omega_{\text{Büchi}}(\A) = L^\omega_{\text{co-Büchi}}(\overline \A) = \tilde L$. Let $Q,\overline Q$ be the states of $\A,\overline \A$. Now look at the product automaton $\A \times \overline \A =: \Ax$ with states $Q \times \overline Q$ and final states $F \times \overline F \subseteq Q \times \overline Q$. $\Ax$ is also deterministic.

%Let $(q,\overline q) \in Q \times \overline F$. If $\overline q$ is not part of a loop in $\A$, we can just take it away from $\overline F$ and get the same $\omega$-language (no matter if Büchi or co-Büchi). Thus assume that all $\overline q \in \overline F$ are part of a loop.

%Let $\alpha \in \tilde L$. Then $\rho(\alpha)$ has infinity many occurences in $F$ and there is some $N$ so that $\overline \rho(\alpha)[N,\infty)$ is only in $\overline F$. Let $\beta \not\in \tilde L$. Then there is some $N$ so that $\rho(\alpha)[N,\infty)$ is only in $Q-F$.

%S305.1
In $\Ax$, we have
\begin{align*}
& \alpha \in \tilde L \\
\Leftrightarrow \ & \forall N \colon \exists n \ge N \colon \overx{\rho}(\alpha)[n] \in F \times \overline Q \\
\Leftrightarrow \ & \exists N \colon \forall n \ge N \colon \overx{\rho}(\alpha)[n] \in Q \times \overline F
\end{align*}

Look at strongly connected component (SCC) $S$ in $\Ax$. We have $S \cap F \times \overline Q \neq \emptyset$, iff $S$ accepts. It follows that all states in $S$ are finite states in $\overline \A$, i.e. $S \cap Q \times \overline F = S$.

Single $\overx{q} \in \overx{Q}$ which are not part of a SCC can be ignored. For the acceptance of infinte words, only SCCs are relevant. For $S$, define $S_+ := \Set{\overx{q} \in \overx{Q}-S}{\overx{q} \text{ can be visited after } S}$.

Then we have
\begin{align*}
\tilde L = \bigcup_{\text{SCC } S} & S \text{ will be visited} \ \wedge \\
& \text{all states of } S \text{ will be visited forever after some step} \ \wedge \\
& S_+ \text{ will not be visited} .
\end{align*}

%S305.2:
$S$ will be visited: Let $S$ exactly be the finite states. This interpreted as an E-automaton $\A^E_S$ is exactly the condition.

Only the allowed states will be visited but nothing followed after $S$: Mark $S$ and all states on all paths to $S$ as finite states. This as an A-automaton $\A^A_S$ is exactly the condition.

A similar negated condition might be simpler: Let $S_+$ be exactly the finite states. Interpret this as an E-automaton $\A^E_{S_+}$.

Then we have
\begin{align*}
\tilde L & = \bigcup_{\text{SCC } S} L^\omega_E (\A^E_S) \cap L^\omega_A (\A^A_S) \\
& = \bigcup_{\text{SCC } S} L^\omega_E (\A^E_S) \cap -L^\omega_E (\A^E_{S_+}) .
\end{align*}

Thus,
\[ \tilde L \in \BC \ext \Lang^*(reg) . \]

%TODO...
Open question at this point: Is $L^*(\A^E_S), L^*(\A^E_{S_+}) \in \Lang$? With E4, this is obviously the case. However, E4 is too strong.

\

%S305.3:
Now let us show $\BC \ext \Lang \subseteq \lim \Lang$.

With E1, we get $\ext \Lang \subseteq \lim \Lang$ and $\ext \Lang \subseteq \dlim \Lang$. I.e. $\ext \Lang \subseteq \lim \cap \dlim \Lang$. Let us show that $\lim \cap \dlim \Lang$ is closed under BC.

Let $\tilde L_a,L_b \in \lim \cap \dlim \Lang$, i.e. $\exists L_{a1}, L_{a2}, L_{b1}, L_{b2} \in \Lang \colon \tilde L_a = \lim L_{a1} = \dlim L_{a2}, \tilde L_b = \lim L_{b1} = \dlim L_{b2}$. Let us show 1. $-\tilde L_a \in \lim \cap \dlim \Lang$, 2. $\tilde L_a \cup \tilde L_b \in \lim \cap \dlim \Lang$.
\begin{enumerate}
\item $-\tilde L_a = -\lim L_{a1} = \dlim -L_{a1}$, $-\tilde L_b = -\dlim L_{a2} = \lim -L_{a2}$. With E3 (closed under negation), we get
\[ -\tilde L_a \in \lim \cap \dlim \Lang . \]

\item
$\tilde L_a \cup \tilde L_b = \lim L_{a1} \cup \lim L_{b1} = \lim L_{a1} \cup L_{b1}$ (\ref{gen:general}). Thus, with E2a, we have
\[ \tilde L_a \cup \tilde L_b \in \lim \Lang . \]

The $\dlim\Lang$ case is harder.
%S305.5: language theoretical proof: TODO
%S305.6:
Let $\A_a$, $\A_b$ be deterministic automaton, so that $L^\omega_{\text{Büchi}}(\A_a) = L^\omega_{\text{co-Büchi}}(\A_a) = \tilde L_a$, $L^\omega_{\text{Büchi}}(\A_b) = L^\omega_{\text{co-Büchi}}(\A_b) = \tilde L_b$. Look at the product automaton $\A_a \times \A_b =: \Ax$. Then we have $L^\omega_{\text{Büchi}}(\Ax) = L^\omega_{\text{co-Büchi}}(\Ax) = \tilde L_a \cup \tilde L_b$.

Thus,
\[ \tilde L_a \cup \tilde L_b \in \dlim \Lang^*(reg) . \]

Open question: Is $L^*(\Ax) \in \Lang$?

\end{enumerate}

%S406.1: TODO...
%S402: TODO...

\subsection{Kleene-star $= \BC \lim$}
\label{gen:kleene-star}
%S407: TODO...
%S306, S306.1:
Let $U,V \in \Lang$. Look at the non-deterministic automaton $\A$ defined as:
\[
  \begin{tikzpicture}[%
    >=stealth,
	shorten >=1pt,
	node distance=2cm,
    auto,
  ]
    \node (U)              {$U$};
    \node (V) [right of=U] {$V \odot$};

    \path[->] (U) +(-1,0) edge (U)
              (U)         edge              node {$\epsilon$} (V)
              (V)         edge  [loop above]       node {} ()
              ;
  \end{tikzpicture}
\]

Then we have $L^\omega_{\text{Büchi}}(\A) = U \cdot V^\omega$.

Let us construct deterministic automata for $\A$ so that we can formulate 'V will be visited and not be left anymore' and 'finite states of the V-related automaton will be visited infinitely often' (or '$UV^*$ will be visited infinitely often').

In a constructed automaton, we must be able to tell wether we are in $U$ or we deterministically have been in $U$ the previous state. In a state power set construction, we can tell wether we are deterministically in $U$ or not. If we are non-determinstic and we may be in both $U$ or $V$ and we get an input symbol which determines that we have been in $U$, we might not be able to tell from the following power set. Example:

Let $U = (a+b)^*$, $V = \Set{b}$. I.e. $UV^\omega = \Set{\alpha \in \Set{a,b}^\omega}{\text{at one point in $\alpha$, there are only $b$s}}$. The non-deterministic automaton is:
\[
  \begin{tikzpicture}[%
    >=stealth,
	shorten >=1pt,
	node distance=2cm,
    auto,
  ]
    \node[state] (1)              {$1$};
    \node[state,double] (2) [right of=1] {$2$};
	
    \path[->]
    (1) +(-1,0) edge (1)
    (1) edge [loop above] node {$a,b$} ()
    (1) edge node {$\epsilon$} (2)
    (2) edge [loop above] node {$b$} ()
    ;
  \end{tikzpicture}
\]

Powerset construction: The initial state is $\Set{1,2}$. Then we have:
\begin{itemize}
\item $\Set{1,2} \overset{a}\rightarrow \Set{1,2}$
\item $\Set{1,2} \overset{b}\rightarrow \Set{1,2}$
\end{itemize}
This gives the $*$-language $\Set{a,b}^*$ and we cannot formulate $UV^\omega$ in any way from there.

In the construction, when we got the $a$ from $\Set{1,2}$, we knew that we have been deterministically in $1$, i.e. in $U$. We loose this information. To keep it, we introduce another state flag which exactly says wether we have determined that we have been in $U$. Thus, we construct an automaton with the states $\Power(Q) \times \B_{\text{det. been in $U$}}$, where $Q$ are the states from $\A$.

For the example, we get the initial state $(\Set{1,2},1)$. Then we have:
\begin{itemize}
\item $(\Set{1,2},1) \overset{a}\rightarrow (\Set{1,2},1)$
\item $(\Set{1,2},1) \overset{b}\rightarrow (\Set{1,2},0)$
\item $(\Set{1,2},0) \overset{a}\rightarrow (\Set{1,2},1)$
\item $(\Set{1,2},0) \overset{b}\rightarrow (\Set{1,2},0)$
\end{itemize}
This is the automaton
\[
  \begin{tikzpicture}[%
    >=stealth,
	shorten >=1pt,
	node distance=2cm,
    auto,
  ]
    \node[state] (1)              {$\Set{1,2},1$};
    \node[state] (2) [right of=1] {$\Set{1,2},0$};

    \path[->]
    (1) +(-1.5,0) edge (1)
    (1) edge [loop above] node {$a$} ()
    (1) edge [bend left] node {$b$} (2)
    (2) edge [bend left] node {$a$} (1)
    (2) edge [loop above] node {$b$} ()
    ;
  \end{tikzpicture}
\]

When we mark all states from $V$ and where we have not been deterministically in $U$ as final, this as a co-Büchi automaton gives exactly the condition 'V will be visited and not be left anymore'. Let $L_E$ be the $*$-language of this automata. Note that $L_E \neq UV^*$ in general and esp. in the example.

When we mark the final states as in the original non-deterministic automata, no matter about $\B_{\text{det. been in $U$}}$, with Büchi-acceptance, we get the condition '$UV^*$ will be visited infinitely often'. This is just $\lim UV^*$.

Together, we get $UV^\omega$, i.e.:
\[ \lim UV^* \cap \dlim L_E = UV^\omega \]

If we have $L_E \in \Lang$, it follows
\[ \Set{ \bigcup_{i=1}^n U_i \cdot V_i^\omega}{U_i, V_i \in \Lang} = \Kleene \Lang \subseteq \BC \lim \Lang . \]

Open question: Is $L_E \in \Lang$?

\

We also need to show $\BC \lim \Lang \subseteq \Kleene \Lang$.

%S306.3:
Show: $\lim \Lang \subseteq \Kleene \Lang$.

Proof: Let $\A$ be a deterministic Büchi automaton for some language $\tilde L = L^\omega_{\text{Büchi}}(\A) \in \Lang$ with final states $F$.

For all finite states $q \in F$: If $q$ is not part of a strongly connected component (SCC), we can ignore it. Let $S$ be the SCC where $q \in S$. Then the set of all $\alpha \in \Sigma^\omega$ which are infinitely often in $q$ can be described as $U_q \cdot V_q^\omega$, where $U_q$ is the set of words so that we arrive in $q$ and $V_q$ is the set of words so that we get from $q$ to $q$. Both sets are regular.

Thus,
\[ \tilde L = L^\omega_{\text{Büchi}}(\A) = \bigcup_{q \in F} U_q V_q^\omega . \]

Obviously, the Kleene-Closure is closed under union.

TODO: Show that Kleene-Closure is closed under negation. (S306.5) (Follows with non-det Büchi complementation but a more generic proof might be useful.)

\subsection{$\Lang(R)$ for a relation $R\subseteq\Sigma^* \times \Sigma^*$}

%S307
If a language class $\Lang(R)$ is defined as finite union of equivalation classes of a relation $R \subseteq \Sigma^* \times \Sigma^*$ and
\begin{itemize}
\item the set of equivalent classes of $R$ is finite,
\item $(v,w) \in R \ \Leftrightarrow \ (va,wa) \in R \ \forall a \in \Sigma$
\end{itemize}
(this is the case for LT, LTT, PT),
then we can construct a canonical deterministic automaton $\A_R$ which has $S_R := \Sigma^* / R$ as states, $\left<\epsilon\right>_R$ is the initial state and the transitions are according to concatenation. Call this an $R$-automaton.

The set of all such $R$-automatoa, varying in the final state set, is isomprophic to $\Lang(R)$. We have
\[ \Lang(R) = \Set{L(\A_R(F))}{F \subseteq S_R} =: \Lang^*(\A_R) . \]

Analogously for $\omega$, we get the set of $R$-E-automata with the $\omega$-language-class
\[ \Lang^\omega_E(\A_R) := \Set{L^\omega(\A^E_R(F))}{F \subseteq S_R} , \]
$R$-Büchi-automata and
\[ \Lang^\omega_{\text{Büchi}} (\A_R) := \Set{L^\omega(\A_R^{\text{Büchi}})}{F \subseteq S_R} , \]
$R$-Muller-automata and
\[ \Lang^\omega_{\text{Muller}} (\A_R) := \Set{L^\omega(\A_R^{\text{Muller}})}{F \subseteq 2^{S_R}} . \]

%S307.1
For a relation $R$ on $\Sigma^*$, there are various ways to construct a relation on $\Sigma^\omega$. For now, we mainly study $R^\omega := \dext R$, i.e.
\[ (\alpha,\beta) \in R^\omega \ :\Leftrightarrow \ \forall n \colon (\alpha[0,n],\beta[0,n]) \in R . \]

Analogously to $\Lang(R)$, define the $\omega$-language-class
\[ \Lang^\omega(R^\omega) := \Set{L^\omega}{\text{$L^\omega$ is finite union of $R^\omega$-equivalence-classes}} . \]

With this preparation, we show for some $R$ the equalities:
\begin{itemize}
\item $\Lang^\omega_E(\A_R) = \ext \Lang(R)$
\item $\Lang^\omega_{\text{Büchi}}(\A_R) = \lim \Lang(R)$
\item $\Lang^\omega_{\text{Muller}}(\A_R) = \BC \lim \Lang(R)$
\item $\Lang^\omega(R^\omega) = \BC \ext \Lang(R)$
\item $\BC \lim \Lang(R) \cap \ext \Lang(reg) = \ext \Lang(R)$
\item $\BC \lim \Lang(R) \cap \lim \Lang(reg) = \lim \Lang(R)$
\item $\lim \Lang(R) \cap \dlim \Lang(R) = \BC \ext \Lang(R)$
\end{itemize}

\subsection{$\Lang^\omega_E(\A_R) = \ext \Lang(R)$}
%S307.2,S307.3
Let $L = \bigcup_i \left< w_i\right>_R, L \in \Lang(R)$. Then
\begin{align*}
& L^\omega = \ext L \\
\Leftrightarrow \ & L^\omega = \Set{\alpha \in \Sigma^\omega}{\exists n \colon \alpha[0,n] \in \bigcup_i \left< w_i\right>_R} \\
\Leftrightarrow \ & L^\omega = \Set{\alpha \in \Sigma^\omega}{\exists n \colon \delta_{\A_R}(\alpha[0,n]) \in \Set{\left< w_i\right>_R \subseteq S_R}{i}} \\
\Leftrightarrow \ & L^\omega = L^\omega(\A^E_R(\Set{\left< w_i\right>_R \subseteq S_R}{i}))
\end{align*}

