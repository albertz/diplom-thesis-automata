%!TEX root =  index.tex
\section{Lemmas}

\subsection{piece-wise testable}

\label{thm.PT}
\begin{thm}
\[ \BC \ext \Lang^* (\PT) = \BC \lim \Lang^* (\PT) \]
\end{thm}

\begin{proof}

$L$ piece-wise testable $\Leftrightarrow$ $L$ is a boolean algebra of $\Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^*$
\\

$\subseteq$: It is sufficient to show $\ext(\Lang^* (\PT)) \subseteq \BC \lim \Lang^* (\PT)$.

By complete induction:
\begin{align*}
& \ext(\Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^*) = \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^\omega = \lim(\Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^*) \\
& \ext( \neg ( \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^* )) = \Sigma^\omega = \lim( \Sigma^* ) \\
& \ext( \emptyset ) = \emptyset = \lim(\emptyset)
\end{align*}

It is sufficient to show negation only for such ground terms because we can always push the negation down.
\begin{align*}
& \ext(A \cup B) = \ext(A) \cup \ext(B) \\
& \ext(A \cap B) = \ext(A) \cap \ext(B)
\end{align*}

This makes the induction complete.
\\

$\supseteq$: It is sufficient to show $\lim(\Lang^* (\PT)) \subseteq \BC \ext \Lang^* (\PT)$.
\begin{align*}
& \lim(\emptyset) = \ext(\emptyset), \ \lim(\Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^*) = \ext(\Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^*) \ \ \text{(see above)} \\
& \begin{aligned}
\lim( \neg ( \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^* ) ) & = \Set{ \alpha \in \Sigma^\omega }{ \exists^\omega n \colon \alpha [0,n] \notin \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^* } \\
& = \Set{ \alpha \in \Sigma^\omega }{ \forall n \colon \alpha [0,n] \notin \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^* } \\
& = \neg \ext( \Sigma^* a_1 \Sigma^* a_2 \dotsb a_n \Sigma^* )
\end{aligned} \\
& \begin{aligned}
\lim(A \cup B) & = \Set{ \alpha \in \Sigma^\omega }{ \exists^\omega n \colon \alpha[0,n] \in A \cup B } = \lim(A) \cup \lim(B) \\
\lim(A \cap B) & = \Set{ \alpha \in \Sigma^\omega }{ \exists^\omega n \colon \alpha[0,n] \in A \cap B } \\
\intertext{and because $A,B$ are piece-wise testable}
& = \Set{ \alpha \in \Sigma^\omega }{ \exists n : \forall m > n \colon \alpha[0,m] \in A \cap B } = \lim(A) \cap \lim(B)
\end{aligned}
\end{align*}

\end{proof}


\subsection{extension of $\Lang^*(\mathrm{FO[+1]})$}

\begin{thm}
\[ \Lang^\omega (\mathrm{FO[+1]}) = \BC \ext \Lang^*(\mathrm{FO[+1]}) \]
\end{thm}

\begin{proof}
From \cite[Theorem 4.8]{LangAutLogic}, we know that each formular in FO[+1] is equivalent (for both finite and infinite words) to a boolean combination of statements ``sphere $\sigma \in \Sigma^+$ occurs $\geq n$ times''. That statement can be expressed by a sentence of the form
\[ \psi := \exists \overline{x_1} \dotsb \exists \overline{x_n} \varphi(\overline{x_1}, \dotsb, \overline{x_n}) \]
where each $\overline{x_i}$ is a $\abs{\sigma}$-tuple of variables and the formula $\varphi$ states:
\[
\bigwedge_{\mathclap{i,j \in \underline{n},\atop { i \neq j,\atop k,l \in \underline{\abs{\sigma}}}}} x_{i,k} \neq x_{j,l}
\ \wedge\ \bigwedge_{\mathclap{i \in \underline{n},\atop k \in \underline{\abs{\sigma}-1}}} x_{i,k+1} = x_{i,k} + 1
\ \wedge\ \bigwedge_{\mathclap{i \in \underline{n},\atop k \in \underline{\abs{\sigma}}}} Q_{\sigma_k} x_{i,k}
\]
For $\psi$, we have:
\[ \alpha \models \psi \Leftrightarrow \exists n \colon \alpha[0,n] \models \psi \ \ \text{for all } \alpha \in \Sigma^\omega , \]
i.e.
\[ L^\omega(\psi) = \ext L^*(\psi) . \]
Any formular in FO[+1] can be expressed as a boolean combination of $\psi$-like formular. With
\begin{align*}
& L^\omega(\neg \psi) = \neg L^\omega(\psi) \\
& L^\omega(\psi_1 \wedge \psi_2) = L^\omega(\psi_1) \cap L^\omega(\psi_2) \\
& L^\omega(\psi_1 \vee \psi_2) = L^\omega(\psi_1) \cup L^\omega(\psi_2)
\end{align*}
we get:
\[ \Lang^\omega(\mathrm{FO[+1]}) = \BC \ext \Lang^*(\mathrm{FO[+1]}). \]

\end{proof}


\subsection{limit of $\Lang^*(\mathrm{FO[<]})$}

\begin{thm}
\[ \Lang^\omega (\mathrm{FO[<]}) = \BC \lim \Lang^*(\mathrm{FO[<]}) \]
\end{thm}

\begin{proof}
Let $\varphi \in \mathrm{FO[<]}$. By the \cite[Normal Form Theorem (4.4)]{CombTheoryOmegaAut} there are bounded formulas $\varphi_1(y),\dotsb,\varphi_r(y),\psi_1(y),\dotsb,\psi_r(y)$ such that for all $\alpha \in \Sigma^\omega$:
\[ \alpha \models \varphi \Leftrightarrow \alpha \models \bigvee_{i=1}^r \left( \forall x \exists y > x \colon \varphi_i (y) \right) \wedge \neg \left( \forall x \exists y > x \colon \psi_i (y) \right) \]
Thus:
\[
\alpha \models \varphi \Leftrightarrow \bigvee_{i=1}^r
\underbrace{ \left( \alpha \models \forall x \exists y > x \colon \varphi_i (y) \right) }_
{\mathclap{\quad\quad \begin{aligned}
& \Leftrightarrow \forall x \exists y > x \colon \alpha[0,n] \models \varphi_i(\omega) \\
& \Leftrightarrow \exists^\omega n \colon \alpha[0,n] \models \varphi_i(\omega) \\
& \Leftrightarrow \alpha \in \lim L^*( \varphi_i(\omega) )
\end{aligned}}}
\wedge \neg \left( \alpha \models \forall x \exists y > x \colon \psi_i (y) \right)
\]
where $\varphi_i(\omega)$ stands for $\varphi_i$ with all bounds removed.
I.e. we have
\[ L^\omega(\varphi) = \bigcup_{i=1}^r \lim( L^* (\varphi_i (\omega)) \cap \neg \lim( L^* (\psi_i (\omega))) , \]
and thus
\[ L^\omega(\varphi) \in \BC \lim \Lang^* (\mathrm{FO[<]}) . \]
We have prooved the $\subseteq$-direction. For $\supseteq$:
\begin{align*}
& \alpha \in \lim( L^*(\varphi) ) \\
\Leftrightarrow \ & \exists^\omega n \colon \alpha[0,n] \models \varphi \\
\Leftrightarrow \ & \alpha \models \forall x \exists y > x \colon \varphi(y) \\
\Leftrightarrow \ & \alpha \in L^\omega ( \forall \exists y > x \colon \varphi(y) )
\end{align*}
where $\varphi(y)$ stands for $\varphi$ with all variables bounded by $y$.
I.e.
\[ \lim \Lang^* (\mathrm{FO[<]}) \subseteq \Lang^\omega (\mathrm{FO[<]}) , \]
and thus also
\[ \BC \lim \Lang^* (\mathrm{FO[<]}) \subseteq \Lang^\omega (\mathrm{FO[<]}) . \]
Thus we have prooved the equality.
\end{proof}


\subsection{$\BC \ext \Lang^*( \mathrm{FO[<]} ) \subsetneqq \BC \lim \Lang^* ( \mathrm{FO[<]} )$}

\begin{thm}
\[ \BC \ext \Lang^*( \mathrm{FO[<]} ) \subsetneqq \BC \lim \Lang^* ( \mathrm{FO[<]} ) \]
\end{thm}

\begin{proof}
$\subseteq$: $L \subset \Sigma^\omega \text{ starfree } \ \Rightarrow\ L \Sigma^\omega \in \lim( \Lang^*( \mathrm{FO[<]} ) )$
\end{proof}
\begin{proof}
$\neq$:
\begin{align*}
& L := (\Sigma^* a)^\omega \\
\Rightarrow \ & L = \lim( (\Sigma^* a)^* ) \\
\Rightarrow \ & L = L^\omega(\exists^\omega x : Q_a x)
\end{align*}
And we have $L \notin \BC \ext \Lang^* (\mathrm{FO[<]})$.
\end{proof}


\subsection{locally testable}

\begin{thm}
\[ \BC \lim \Lang^*(\LT) \supsetneqq \BC \ext \Lang^* (\LT) \]
\end{thm}

\begin{proof}
Let $w \in \Sigma^+$.
\begin{align*}
& \ext (w \Sigma^*) = \lim(w \Sigma^*) \\
& \ext( \Sigma^* w) = \Sigma^* w \Sigma^\omega = \lim( \Sigma^* w \Sigma^* ) \\
& \ext( \Sigma^* w \Sigma^*) = \Sigma^* w \Sigma^\omega = \lim( \Sigma^* w \Sigma^* )
\end{align*}
Thus we have
\[ \BC \ext \Lang^* (\LT) \subseteq \BC \lim \Lang^*(\LT) . \]
But we also have
\[ \lim(\Sigma^*) = (\Sigma^* w)^\omega \notin \BC \ext \Lang^* (\LT) . \]
\end{proof}


\subsection{positive \PT}

\label{thm.ext.lim.posPT}
\begin{thm}
\[ \BC \ext \Lang^* (\mathtext{pos-PT}) = \BC \lim \Lang^* (\mathtext{pos-PT}) \]
\end{thm}

\begin{proof}
$\subseteq$: Exactly like the proof for PT except that we leave out the negated part.
$\supseteq$: Also like the proof for PT.
\end{proof}


\subsection{pos-PT and PT}

\begin{thm}
\[ \BC \ext \Lang^*(\mathtext{pos-PT}) = \BC \ext \Lang^* (\mathtext{PT}) \]
\end{thm}

\begin{proof}
In the proof of $\lim \Lang^*(\mathtext{PT}) \subseteq \BC \ext \Lang^* (\mathtext{PT})$ we actually proved $\BC \lim \Lang^*(\mathtext{PT}) \subseteq \BC \ext \Lang^* (\mathtext{pos-PT})$. Similiarly we also proved $\BC \ext \Lang^* (\mathtext{PT}) \subseteq \BC \lim \Lang^* (\mathtext{pos-PT})$.

With \ref{thm.ext.lim.posPT} and \ref{thm.PT} we get the claimed equality.
\end{proof}

